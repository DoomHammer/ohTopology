// setup type of network
mock network medium

expect Room Added: Kitchen at 0
expect Kitchen open ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open ZoneReceiver True 
expect Kitchen open HasListeners False
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute False
expect Kitchen open Zone Volume 50

expect Room Added: Sitting Room at 1
expect Sitting Room open ZoneSender True 4c494e4e-0026-0f99-1112-ef000004013f Sitting Room
expect Sitting Room open ZoneReceiver True 
expect Sitting Room open HasListeners False
expect Sitting Room open Zone HasVolume True
expect Sitting Room open Zone Mute False
expect Sitting Room open Zone Volume 50

expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 50

expect Room Added: Dining Room at 1
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
empty

// switch to receiver source on bedroom
mock network update 4c494e4e-0026-0f99-1113-ef000004013f product sourceindex 3
empty

// add bedroom to kitchen zone
mock house zone Kitchen add Bedroom
expect Kitchen add Listener Bedroom
expect Kitchen update HasListeners True
expect Bedroom update ZoneReceiver True Kitchen
expect Room Removed: Bedroom at 0
empty

// switch to receiver source on dining room and event listening to kitchen
mock network update 4c494e4e-0026-0f99-1114-ef000004013f product sourceindex 3
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver metadata kitchen ohz://239.255.255.250:51972/4c494e4e-0026-0f99-1111-ef000004013f
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Playing
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
expect Room Removed: Dining Room at 0
empty

// check that "Stopped" removes Dining Room from Kitchen and "Waiting"/"Buffering" adds Dining Room to Kitchen
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Room Added: Dining Room at 0
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Waiting
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
expect Room Removed: Dining Room at 0
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Room Added: Dining Room at 0
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Buffering
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
expect Room Removed: Dining Room at 0
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Playing
empty

// check adding rooms to a sender that comes online later
mock network update 4c494e4e-0026-0f99-1111-ef000004013f sender status Disabled
expect Kitchen update ZoneSender False  Kitchen
expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 50
expect Room Added: Dining Room at 1
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
empty
mock network update 4c494e4e-0026-0f99-1111-ef000004013f sender status Enabled
expect Kitchen update ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open HasListeners False
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute False
expect Kitchen open Zone Volume 50
expect Kitchen add Listener Bedroom
expect Kitchen update HasListeners True
expect Bedroom update ZoneReceiver True Kitchen
expect Room Removed: Bedroom at 0
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
expect Room Removed: Dining Room at 0
empty

// remove bedroom
mock network remove 4c494e4e-0026-0f99-1113-ef000004013f
expect Kitchen remove Listener Bedroom
expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 50
expect Room Removed: Bedroom at 0
empty
mock network add 4c494e4e-0026-0f99-1113-ef000004013f
expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 50
expect Kitchen add Listener Bedroom
expect Bedroom update ZoneReceiver True Kitchen
expect Room Removed: Bedroom at 0
empty

// remove kitchen and re-add
mock network remove 4c494e4e-0026-0f99-1111-ef000004013f
expect Kitchen remove Listener Bedroom
expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 50
expect Kitchen remove Listener Dining Room
expect Kitchen update HasListeners False
expect Room Added: Dining Room at 1
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
expect Room Removed: Kitchen at 2
empty

mock network add 4c494e4e-0026-0f99-1111-ef000004013f
expect Room Added: Kitchen at 2
expect Kitchen open ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open ZoneReceiver True 
expect Kitchen open HasListeners False
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute False
expect Kitchen open Zone Volume 50
expect Kitchen add Listener Bedroom
expect Kitchen update HasListeners True
expect Bedroom update ZoneReceiver True Kitchen
expect Room Removed: Bedroom at 0
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
expect Room Removed: Dining Room at 0
empty

// mute all rooms in kitchen zone
mock network update 4c494e4e-0026-0f99-1111-ef000004013f volume mute true
empty

mock network update 4c494e4e-0026-0f99-1113-ef000004013f volume mute true
empty

mock network update 4c494e4e-0026-0f99-1114-ef000004013f volume mute true
expect Kitchen update Zone Mute True
empty

// check that kitchen zone in mute true state changes to mute false when room that is mute false is added
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Room Added: Dining Room at 0
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute True
expect Dining Room open Zone Volume 50
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f volume mute false
expect Dining Room update Zone Mute False
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Playing
expect Kitchen add Listener Dining Room
expect Kitchen update Zone Mute False
expect Dining Room update ZoneReceiver True Kitchen
expect Room Removed: Dining Room at 0
empty

mock network update 4c494e4e-0026-0f99-1113-ef000004013f volume value 100
expect Kitchen update Zone Volume 66
empty
mock network update 4c494e4e-0026-0f99-1111-ef000004013f volume value 100
expect Kitchen update Zone Volume 83
empty

// test adding and removing of satellite rooms
mock network update 4c494e4e-0026-0f99-1112-ef000004013f product source 3 name Dining Room
expect Room Removed: Sitting Room at 1
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Kitchen update Zone Mute True
expect Kitchen update Zone Volume 100
expect Room Added: Dining Room at 0
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room add Satellite Sitting Room
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
empty

mock network remove 4c494e4e-0026-0f99-1112-ef000004013f
expect Dining Room remove Satellite Sitting Room
expect Room Added: Sitting Room at 2
expect Sitting Room open ZoneSender True 4c494e4e-0026-0f99-1112-ef000004013f Sitting Room
expect Sitting Room open ZoneReceiver True 
expect Sitting Room open HasListeners False
expect Sitting Room open Zone HasVolume True
expect Sitting Room open Zone Mute False
expect Sitting Room open Zone Volume 50
expect Room Removed: Sitting Room at 2
empty

mock network add 4c494e4e-0026-0f99-1112-ef000004013f
expect Room Added: Sitting Room at 2
expect Sitting Room open ZoneSender True 4c494e4e-0026-0f99-1112-ef000004013f Sitting Room
expect Sitting Room open ZoneReceiver True 
expect Sitting Room open HasListeners False
expect Sitting Room open Zone HasVolume True
expect Sitting Room open Zone Mute False
expect Sitting Room open Zone Volume 50
expect Dining Room add Satellite Sitting Room
expect Room Removed: Sitting Room at 2
empty

mock network create ds 69
mock network add 69
expect Room Added: Main Room at 2
expect Main Room open ZoneSender True 69 Main Room
expect Main Room open ZoneReceiver True 
expect Main Room open HasListeners False
expect Main Room open Zone HasVolume True
expect Main Room open Zone Mute False
expect Main Room open Zone Volume 50
empty

// test chaining of rooms
// we don't see listener added to Bedroom as Bedroom is not in the list of rooms as it is listening to Kitchen
mock house zone Bedroom add Dining Room
expect Kitchen add Listener Dining Room
expect Kitchen update Zone Mute False
expect Kitchen update Zone Volume 83
expect Dining Room update ZoneReceiver True Bedroom
expect Room Removed: Dining Room at 0
empty

mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Kitchen update Zone Mute True
expect Kitchen update Zone Volume 100
expect Room Added: Dining Room at 0
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room add Satellite Sitting Room
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
empty

mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Playing
expect Kitchen add Listener Dining Room
expect Kitchen update Zone Mute False
expect Kitchen update Zone Volume 83
expect Dining Room update ZoneReceiver True Bedroom
expect Room Removed: Dining Room at 0
empty

// test cyclic
mock network update 4c494e4e-0026-0f99-1114-ef000004013f product room DiningRoom
expect Kitchen remove Listener Dining Room
expect Kitchen update Zone Mute True
expect Kitchen update Zone Volume 100
expect Room Added: Dining Room at 0
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room add Satellite Sitting Room
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
expect Dining Room remove Satellite Sitting Room
expect Room Added: Sitting Room at 3
expect Sitting Room open ZoneSender True 4c494e4e-0026-0f99-1112-ef000004013f Sitting Room
expect Sitting Room open ZoneReceiver True 
expect Sitting Room open HasListeners False
expect Sitting Room open Zone HasVolume True
expect Sitting Room open Zone Mute False
expect Sitting Room open Zone Volume 50
expect Room Removed: Dining Room at 0
expect Room Added: DiningRoom at 0
expect DiningRoom open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f DiningRoom
expect DiningRoom open ZoneReceiver True 
expect DiningRoom open HasListeners False
expect DiningRoom open Zone HasVolume True
expect DiningRoom open Zone Mute False
expect DiningRoom open Zone Volume 50
expect Kitchen add Listener DiningRoom
expect Kitchen update Zone Mute False
expect Kitchen update Zone Volume 83
expect DiningRoom update ZoneReceiver True Bedroom
expect Room Removed: DiningRoom at 0
empty

mock house zone DiningRoom add Kitchen
expect Kitchen add Listener Kitchen
expect Kitchen update ZoneReceiver True DiningRoom
empty

// test adding a satellite room
mock network create ds 60
empty
mock network update 60 product room test1
empty
mock network update 60 product source 3 name test2
empty
mock network add 60
expect Room Added: test1 at 3
expect test1 open ZoneSender True 60 test1
expect test1 open ZoneReceiver True 
expect test1 open HasListeners False
expect test1 open Zone HasVolume True
expect test1 open Zone Mute False
expect test1 open Zone Volume 50
empty

mock network create ds 62
empty
mock network update 62 product room test2
empty
mock network add 62
expect Room Added: test2 at 4
expect test2 open ZoneSender True 62 test2
expect test2 open ZoneReceiver True 
expect test2 open HasListeners False
expect test2 open Zone HasVolume True
expect test2 open Zone Mute False
expect test2 open Zone Volume 50
expect test2 add Satellite test1
expect Room Removed: test1 at 3
empty

// test adding master satellite without a sender
mock network remove 62
expect test2 remove Satellite test1
expect Room Added: test1 at 3
expect test1 open ZoneSender True 60 test1
expect test1 open ZoneReceiver True 
expect test1 open HasListeners False
expect test1 open Zone HasVolume True
expect test1 open Zone Mute False
expect test1 open Zone Volume 50
expect Room Removed: test2 at 4
empty

mock network update 62 sender status Disabled
empty
mock network add 62
expect Room Added: test2 at 4
expect test2 open ZoneSender False  test2
expect test2 open ZoneReceiver True 
empty

// enable the sender
mock network update 62 sender status Enabled
expect test2 update ZoneSender True 62 test2
expect test2 open HasListeners False
expect test2 open Zone HasVolume True
expect test2 open Zone Mute False
expect test2 open Zone Volume 50
expect test2 add Satellite test1
expect Room Removed: test1 at 3
empty

// start playing in satellite room
mock house zone test2 add test1
expect test2 add Listener test1
expect test2 update HasListeners True
empty

// disable the sender
mock network update 62 sender status Disabled
expect test2 update ZoneSender False  test2
expect test2 remove Satellite test1
expect Room Added: test1 at 3
expect test1 open ZoneSender True 60 test1
expect test1 open ZoneReceiver True 
expect test1 open HasListeners False
expect test1 open Zone HasVolume True
expect test1 open Zone Mute False
expect test1 open Zone Volume 50
empty

// unhook all rooms
mock network update 4c494e4e-0026-0f99-1111-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Kitchen
expect Kitchen update ZoneReceiver True 
empty
mock network update 4c494e4e-0026-0f99-1112-ef000004013f receiver transportstate Stopped
empty
mock network update 4c494e4e-0026-0f99-1113-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener DiningRoom
expect Kitchen update Zone Mute True
expect Kitchen update Zone Volume 100
expect Kitchen remove Listener Bedroom
expect Kitchen update HasListeners False
expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open HasListeners True
expect Bedroom add Listener DiningRoom
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 75
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Bedroom remove Listener DiningRoom
expect Bedroom update Zone Mute True
expect Bedroom update Zone Volume 100
expect Bedroom update HasListeners False
expect Room Added: DiningRoom at 1
expect DiningRoom open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f DiningRoom
expect DiningRoom open ZoneReceiver True 
expect DiningRoom open HasListeners False
expect DiningRoom open Zone HasVolume True
expect DiningRoom open Zone Mute False
expect DiningRoom open Zone Volume 50
empty

// test cyclic songcast setup #1158
mock house zone Kitchen add Bedroom
expect Kitchen add Listener Bedroom
expect Kitchen update HasListeners True
expect Bedroom update ZoneReceiver True Kitchen
expect Room Removed: Bedroom at 0
empty
mock house zone Kitchen add DiningRoom
expect Kitchen add Listener DiningRoom
expect Kitchen update Zone Mute False
expect Kitchen update Zone Volume 83
expect DiningRoom update ZoneReceiver True Kitchen
expect Room Removed: DiningRoom at 0
empty

mock house zone DiningRoom add Kitchen
expect Kitchen add Listener Kitchen
expect Kitchen update ZoneReceiver True DiningRoom
empty

// remove cyclical room
mock network remove 4c494e4e-0026-0f99-1111-ef000004013f
expect Kitchen remove Listener Bedroom
expect Kitchen update Zone Volume 75
expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute True
expect Bedroom open Zone Volume 100
expect Kitchen remove Listener Kitchen
expect Kitchen remove Listener DiningRoom
expect Kitchen update Zone Mute True
expect Kitchen update Zone Volume 100
expect Kitchen update HasListeners False
expect Room Added: DiningRoom at 1
expect DiningRoom open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f DiningRoom
expect DiningRoom open ZoneReceiver True 
expect DiningRoom open HasListeners True
expect DiningRoom add Listener Kitchen
expect DiningRoom open Zone HasVolume True
expect DiningRoom open Zone Mute False
expect DiningRoom open Zone Volume 75
expect DiningRoom remove Listener Kitchen
expect DiningRoom update Zone Volume 50
expect DiningRoom update HasListeners False
expect Kitchen update ZoneReceiver True 
expect Room Removed: Kitchen at 2
empty

mock network remove 4c494e4e-0026-0f99-1113-ef000004013f
expect Room Removed: Bedroom at 0
empty

mock network remove 4c494e4e-0026-0f99-1114-ef000004013f
expect Room Removed: DiningRoom at 0
empty

mock network add 4c494e4e-0026-0f99-1111-ef000004013f
expect Room Added: Kitchen at 0
expect Kitchen open ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open ZoneReceiver True 
expect Kitchen open HasListeners False
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute True
expect Kitchen open Zone Volume 100
empty

mock network add 4c494e4e-0026-0f99-1114-ef000004013f
expect Room Added: DiningRoom at 0
expect DiningRoom open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f DiningRoom
expect DiningRoom open ZoneReceiver True 
expect DiningRoom open HasListeners False
expect DiningRoom open Zone HasVolume True
expect DiningRoom open Zone Mute False
expect DiningRoom open Zone Volume 50
expect DiningRoom add Listener Kitchen
expect DiningRoom update Zone Volume 75
expect DiningRoom update HasListeners True
expect Kitchen update ZoneReceiver True DiningRoom
expect Room Removed: Kitchen at 1
expect DiningRoom add Listener DiningRoom
expect DiningRoom update ZoneReceiver True Kitchen
empty

mock network update 4c494e4e-0026-0f99-1114-ef000004013f sender status Disabled
expect DiningRoom update ZoneSender False  DiningRoom
expect Room Added: Kitchen at 1
expect Kitchen open ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open ZoneReceiver True 
expect Kitchen open HasListeners True
expect Kitchen add Listener DiningRoom
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute False
expect Kitchen open Zone Volume 75
empty

mock network update 4c494e4e-0026-0f99-1114-ef000004013f sender status Enabled
expect DiningRoom update ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f DiningRoom
expect DiningRoom open HasListeners False
expect DiningRoom open Zone HasVolume True
expect DiningRoom open Zone Mute False
expect DiningRoom open Zone Volume 50
expect DiningRoom add Listener DiningRoom
expect DiningRoom update HasListeners True
expect DiningRoom add Listener Kitchen
expect DiningRoom update Zone Volume 75
expect Kitchen update ZoneReceiver True DiningRoom
expect Room Removed: Kitchen at 1
empty

mock network update 4c494e4e-0026-0f99-1111-ef000004013f sender status Disabled
expect DiningRoom remove Listener DiningRoom
expect DiningRoom update ZoneReceiver True 
empty

mock network update 4c494e4e-0026-0f99-1111-ef000004013f sender status Enabled
expect DiningRoom update ZoneReceiver True Kitchen
expect DiningRoom add Listener DiningRoom
empty