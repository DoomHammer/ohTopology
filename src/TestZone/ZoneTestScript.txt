// setup type of network
mock network medium

expect Room Added: Kitchen at 0
expect Kitchen open ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open ZoneReceiver True 
expect Kitchen open Metadata True  
expect Kitchen open HasListeners False
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute False
expect Kitchen open Zone Volume 50

expect Room Added: Sitting Room at 1
expect Sitting Room open ZoneSender True 4c494e4e-0026-0f99-1112-ef000004013f Sitting Room
expect Sitting Room open ZoneReceiver True 
expect Sitting Room open Metadata True  
expect Sitting Room open HasListeners False
expect Sitting Room open Zone HasVolume True
expect Sitting Room open Zone Mute False
expect Sitting Room open Zone Volume 50

expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open Metadata True  
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 50

expect Room Added: Dining Room at 1
expect Dining Room open ZoneSender True 4c494e4e-0026-0f99-1114-ef000004013f Dining Room
expect Dining Room open ZoneReceiver True 
expect Dining Room open Metadata True  
expect Dining Room open HasListeners False
expect Dining Room open Zone HasVolume True
expect Dining Room open Zone Mute False
expect Dining Room open Zone Volume 50
empty

// switch to receiver source on bedroom
mock network update 4c494e4e-0026-0f99-1113-ef000004013f product sourceindex 3
empty

// add bedroom to kitchen zone
mock house zone Kitchen add Bedroom
expect Kitchen add Listener Bedroom
expect Kitchen update HasListeners True
expect Bedroom update ZoneReceiver True Kitchen
empty

// switch to receiver source on dining room and event listening to kitchen
mock network update 4c494e4e-0026-0f99-1114-ef000004013f product sourceindex 3
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver metadata kitchen ohz://239.255.255.250:51972/4c494e4e-0026-0f99-1111-ef000004013f
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Playing
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
empty

// check that "Stopped" removes Dining Room from Kitchen and "Waiting"/"Buffering" adds Dining Room to Kitchen
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Dining Room update ZoneReceiver True 
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Waiting
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Dining Room update ZoneReceiver True 
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Buffering
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Playing
empty

// check adding rooms to a sender that comes online later
mock network update 4c494e4e-0026-0f99-1111-ef000004013f sender status Disabled
expect Kitchen update ZoneSender False  Kitchen
expect Bedroom update ZoneReceiver True 
expect Dining Room update ZoneReceiver True 
empty
mock network update 4c494e4e-0026-0f99-1111-ef000004013f sender status Enabled
expect Kitchen update ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open HasListeners False
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute False
expect Kitchen open Zone Volume 50
expect Kitchen add Listener Bedroom
expect Kitchen update HasListeners True
expect Bedroom update ZoneReceiver True Kitchen
expect Kitchen add Listener Dining Room
expect Dining Room update ZoneReceiver True Kitchen
empty

// remove bedroom
mock network remove 4c494e4e-0026-0f99-1113-ef000004013f
expect Kitchen remove Listener Bedroom
expect Bedroom update ZoneReceiver True 
expect Room Removed: Bedroom at 0
empty
mock network add 4c494e4e-0026-0f99-1113-ef000004013f
expect Room Added: Bedroom at 0
expect Bedroom open ZoneSender True 4c494e4e-0026-0f99-1113-ef000004013f Bedroom
expect Bedroom open ZoneReceiver True 
expect Bedroom open Metadata True  
expect Bedroom open HasListeners False
expect Bedroom open Zone HasVolume True
expect Bedroom open Zone Mute False
expect Bedroom open Zone Volume 50
expect Kitchen add Listener Bedroom
expect Bedroom update ZoneReceiver True Kitchen
empty

// remove kitchen and re-add
mock network remove 4c494e4e-0026-0f99-1111-ef000004013f
expect Kitchen remove Listener Bedroom
expect Bedroom update ZoneReceiver True 
expect Kitchen remove Listener Dining Room
expect Kitchen update HasListeners False
expect Dining Room update ZoneReceiver True 
expect Room Removed: Kitchen at 2
empty

mock network add 4c494e4e-0026-0f99-1111-ef000004013f
expect Room Added: Kitchen at 2
expect Kitchen open ZoneSender True 4c494e4e-0026-0f99-1111-ef000004013f Kitchen
expect Kitchen open ZoneReceiver True 
expect Kitchen open Metadata True  
expect Kitchen open HasListeners False
expect Kitchen open Zone HasVolume True
expect Kitchen open Zone Mute False
expect Kitchen open Zone Volume 50
expect Kitchen add Listener Dining Room
expect Kitchen update HasListeners True
expect Dining Room update ZoneReceiver True Kitchen
expect Kitchen add Listener Bedroom
expect Bedroom update ZoneReceiver True Kitchen
empty

// mute all rooms in kitchen zone
mock network update 4c494e4e-0026-0f99-1111-ef000004013f volume mute true
empty

mock network update 4c494e4e-0026-0f99-1113-ef000004013f volume mute true
expect Bedroom update Zone Mute True
empty

mock network update 4c494e4e-0026-0f99-1114-ef000004013f volume mute true
expect Dining Room update Zone Mute True
expect Kitchen update Zone Mute True
empty

// check that kitchen zone in mute true state changes to mute false when room that is mute false is added
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Stopped
expect Kitchen remove Listener Dining Room
expect Dining Room update ZoneReceiver True 
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f volume mute false
expect Dining Room update Zone Mute False
empty
mock network update 4c494e4e-0026-0f99-1114-ef000004013f receiver transportstate Playing
expect Kitchen add Listener Dining Room
expect Kitchen update Zone Mute False
expect Dining Room update ZoneReceiver True Kitchen
empty

mock network update 4c494e4e-0026-0f99-1113-ef000004013f volume value 100
expect Bedroom update Zone Volume 100
expect Kitchen update Zone Volume 66
empty
mock network update 4c494e4e-0026-0f99-1111-ef000004013f volume value 100
expect Kitchen update Zone Volume 83
empty
