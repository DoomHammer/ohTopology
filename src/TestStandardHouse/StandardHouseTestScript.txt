// setup type of network
mock network medium

// test network is populated with 4 devices
expect Room Added: Kitchen at 0
expect Kitchen open Standby eOn
expect Kitchen open Details False 0 0  0 False 0
expect Kitchen open Metadata False  
expect Kitchen open Metatext False 
expect Kitchen open Zone False 
expect Kitchen open Controller Active True
expect Kitchen open HasVolume False
expect Kitchen open HasSourceControl False
expect Kitchen open Mute False
expect Kitchen open Volume 0
expect Kitchen open TransportState 
expect Kitchen open Time Active True
expect Kitchen open HasTime False
expect Kitchen open Duration 0
expect Kitchen open Seconds 0
expect Room Added: Sitting Room at 1
expect Sitting Room open Standby eOn
expect Sitting Room open Details False 0 0  0 False 0
expect Sitting Room open Metadata False  
expect Sitting Room open Metatext False 
expect Sitting Room open Zone False 
expect Sitting Room open Controller Active True
expect Sitting Room open HasVolume False
expect Sitting Room open HasSourceControl False
expect Sitting Room open Mute False
expect Sitting Room open Volume 0
expect Sitting Room open TransportState 
expect Sitting Room open Time Active True
expect Sitting Room open HasTime False
expect Sitting Room open Duration 0
expect Sitting Room open Seconds 0
expect Room Added: Bedroom at 0
expect Bedroom open Standby eOn
expect Bedroom open Details False 0 0  0 False 0
expect Bedroom open Metadata False  
expect Bedroom open Metatext False 
expect Bedroom open Zone False 
expect Bedroom open Controller Active True
expect Bedroom open HasVolume False
expect Bedroom open HasSourceControl False
expect Bedroom open Mute False
expect Bedroom open Volume 0
expect Bedroom open TransportState 
expect Bedroom open Time Active True
expect Bedroom open HasTime False
expect Bedroom open Duration 0
expect Bedroom open Seconds 0
expect Room Added: Dining Room at 1
expect Dining Room open Standby eOn
expect Dining Room open Details False 0 0  0 False 0
expect Dining Room open Metadata False  
expect Dining Room open Metatext False 
expect Dining Room open Zone False 
expect Dining Room open Controller Active True
expect Dining Room open HasVolume False
expect Dining Room open HasSourceControl False
expect Dining Room open Mute False
expect Dining Room open Volume 0
expect Dining Room open TransportState 
expect Dining Room open Time Active True
expect Dining Room open HasTime False
expect Dining Room open Duration 0
expect Dining Room open Seconds 0
expect Kitchen update Zone True 4c494e4e-0026-0f99-1111-ef000004013f
expect Kitchen update Details True 0 0  0 False 0
expect Kitchen update Metadata True  
expect Kitchen update Metatext True 
expect Kitchen update TransportState Stopped
expect Kitchen update HasSourceControl True
expect Kitchen update Volume 50
expect Kitchen update HasVolume True
expect Kitchen update HasTime True
expect Sitting Room update Zone True 4c494e4e-0026-0f99-1112-ef000004013f
expect Sitting Room update Details True 0 0  0 False 0
expect Sitting Room update Metadata True  
expect Sitting Room update Metatext True 
expect Sitting Room update TransportState Stopped
expect Sitting Room update HasSourceControl True
expect Sitting Room update Volume 50
expect Sitting Room update HasVolume True
expect Sitting Room update HasTime True
expect Bedroom update Zone True 4c494e4e-0026-0f99-1113-ef000004013f
expect Bedroom update Details True 0 0  0 False 0
expect Bedroom update Metadata True  
expect Bedroom update Metatext True 
expect Bedroom update TransportState Stopped
expect Bedroom update HasSourceControl True
expect Bedroom update Volume 50
expect Bedroom update HasVolume True
expect Bedroom update HasTime True
expect Dining Room update Zone True 4c494e4e-0026-0f99-1114-ef000004013f
expect Dining Room update Details True 0 0  0 False 0
expect Dining Room update Metadata True  
expect Dining Room update Metatext True 
expect Dining Room update TransportState Stopped
expect Dining Room update HasSourceControl True
expect Dining Room update Volume 50
expect Dining Room update HasVolume True
expect Dining Room update HasTime True
empty

// test adding a new room
mock network add ds 67
expect Room Added: Main Room at 3
expect Main Room open Standby eOn
expect Main Room open Details False 0 0  0 False 0
expect Main Room open Metadata False  
expect Main Room open Metatext False 
expect Main Room open Zone False 
expect Main Room open Controller Active True
expect Main Room open HasVolume False
expect Main Room open HasSourceControl False
expect Main Room open Mute False
expect Main Room open Volume 0
expect Main Room open TransportState 
expect Main Room open Time Active True
expect Main Room open HasTime False
expect Main Room open Duration 0
expect Main Room open Seconds 0
expect Main Room update Zone True 67
expect Main Room update Details True 0 0  0 False 0
expect Main Room update Metadata True  
expect Main Room update Metatext True 
expect Main Room update TransportState Stopped
expect Main Room update HasSourceControl True
expect Main Room update Volume 50
expect Main Room update HasVolume True
expect Main Room update HasTime True
empty

// test changing details
mock network update ds 67 info details 50 100 flac 500 true 44000
expect Main Room update Details True 50 100 flac 500 True 44000
empty

// test changing metadata
mock network update ds 67 info metadata blah http://blah
expect Main Room update Metadata True blah http://blah
empty

// test changing metatext
mock network update ds 67 info metatext testing
expect Main Room update Metatext True testing
empty

// test room controller active flag
mock network remove ds 67
expect Room Removed: Main Room at 3
empty

// re-add ds 67
mock network add ds 67
expect Room Added: Main Room at 3
expect Main Room open Standby eOn
expect Main Room open Details False 0 0  0 False 0
expect Main Room open Metadata False  
expect Main Room open Metatext False 
expect Main Room open Zone False 
expect Main Room open Controller Active True
expect Main Room open HasVolume False
expect Main Room open HasSourceControl False
expect Main Room open Mute False
expect Main Room open Volume 0
expect Main Room open TransportState 
expect Main Room open Time Active True
expect Main Room open HasTime False
expect Main Room open Duration 0
expect Main Room open Seconds 0
expect Main Room update Zone True 67
expect Main Room update Details True 50 100 flac 500 True 44000
expect Main Room update Metadata True blah http://blah
expect Main Room update Metatext True testing
expect Main Room update TransportState Stopped
expect Main Room update HasSourceControl True
expect Main Room update Volume 50
expect Main Room update HasVolume True
expect Main Room update HasTime True
empty

// add another ds to Main Room
mock network add ds 68
expect Main Room update Zone False 
expect Main Room update HasSourceControl False
expect Main Room update HasSourceControl True
empty

// set DS 68's info
mock network update ds 68 info details 1 2 mp3 3 false 4
mock network update ds 68 info metadata Ds68 http://Ds68
mock network update ds 68 info metatext Ds68
empty

// join ds and ensure info changes from DS 67 info to DS 68 info
mock network update ds 67 product source 0 name Test
expect Main Room update HasSourceControl False
expect Main Room update HasSourceControl True
empty
mock network update ds 68 product name Test
expect Main Room update Details False 0 0  0 False 0
expect Main Room update Metadata False  
expect Main Room update Metatext False 
expect Main Room update HasSourceControl False
expect Main Room update HasTime False
expect Main Room update Zone True 67
expect Main Room update Details True 1 2 mp3 3 False 4
expect Main Room update Metadata True Ds68 http://Ds68
expect Main Room update Metatext True Ds68
expect Main Room update HasSourceControl True
expect Main Room update HasTime True
empty

// change to radio source to check create source controller
mock network update ds 67 product sourceindex 1
expect Main Room update Details False 0 0  0 False 0
expect Main Room update Metadata False  
expect Main Room update Metatext False 
expect Main Room update HasSourceControl False
expect Main Room update HasTime False
expect Main Room update Details True 50 100 flac 500 True 44000
expect Main Room update Metadata True blah http://blah
expect Main Room update Metatext True testing
expect Main Room update HasSourceControl True
expect Main Room update HasTime True
empty

mock network update ds 67 radio transportstate Playing
expect Main Room update TransportState Playing
empty

mock network update ds 67 product sourceindex 3
expect Main Room update HasSourceControl False
expect Main Room update TransportState Stopped
expect Main Room update HasSourceControl True
empty

mock network update ds 67 time duration 60
expect Main Room update Duration 60
empty

mock network update ds 67 time seconds 1
expect Main Room update Seconds 1
empty

mock network update ds 67 time seconds 10
expect Main Room update Seconds 10
empty
